package com.example.yourvelociraptorflowers.ui.fragment;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;

import com.example.yourvelociraptorflowers.R;
import com.example.yourvelociraptorflowers.model.plant.Plants;
import com.example.yourvelociraptorflowers.domain.Allplants.PlantsAdapter;
import com.example.yourvelociraptorflowers.databinding.FragmentVseTvitiBinding;
import com.example.yourvelociraptorflowers.ui.notifications.NotificationsActivity;
import com.example.yourvelociraptorflowers.ui.plants.search.Search_activiti;
import com.example.yourvelociraptorflowers.ui.user.prosmotr.User_profil;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

public class Vse_tviti_Fragment extends Fragment {
    private FragmentVseTvitiBinding binding;
    private PlantsAdapter adapter;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        binding = FragmentVseTvitiBinding.inflate(inflater, container, false);
        return binding.getRoot();
    }

    @Override

    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);

        FirebaseFirestore firestore = FirebaseFirestore.getInstance();
//        Plants newUser2 = new Plants(
//                "–ó–º–µ–∏–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ (–°–∞–Ω—Å–µ–≤–∏–µ—Ä–∏—è) üåø",
//                "–ó–º–µ–∏–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ - —ç—Ç–æ –≤—ã–Ω–æ—Å–ª–∏–≤–æ–µ –∏ –Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ, –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –¥–ª—è –¥–æ–º–∞. üè°",
//                "https://piantica.com/wp-content/uploads/2020/04/Untitled-design17-768x1086.png",
//                "https://media-be.chewy.com/wp-content/uploads/2023/05/01193934/air-purifying-plants-pets-toxic-mobile-scaled.jpg",
//                "https://rastenievod.com/wp-content/uploads/2016/09/6-30.jpg",
//                "https://rastenievod.com/wp-content/uploads/2016/09/4-48-700x700.jpg",
//                "–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è —Ä–æ—Å—Ç–∞ - –æ—Ç 18 –¥–æ 30 –≥—Ä–∞–¥—É—Å–æ–≤. üå°Ô∏è",
//                "–†–∞—Å—Ç–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç —É–º–µ—Ä–µ–Ω–Ω—É—é –≤–ª–∞–∂–Ω–æ—Å—Ç—å –≤–æ–∑–¥—É—Ö–∞, –Ω–æ –º–æ–∂–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ —Å—É—Ö–æ–º—É –≤–æ–∑–¥—É—Ö—É. üíß",
//                "–ó–º–µ–∏–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—Å–µ—è–Ω–Ω—ã–π —Å–≤–µ—Ç –∏ —Ç–µ–Ω—å. –ò–∑–±–µ–≥–∞–π—Ç–µ –ø–µ—Ä–µ—É–≤–ª–∞–∂–Ω–µ–Ω–∏—è –ø–æ—á–≤—ã –∏ –Ω–µ –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ –≤ –≤–æ–¥–µ. ‚òÄÔ∏è",
//                "https://youtu.be/Ql--qX762t4",
//                5 // –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–ª–∏–≤–∞ (—Ä–∞–∑ –≤ 5 –¥–Ω–µ–π)
//        );
//        firestore.collection("plants")
//                .document()
//                .set(newUser2);
//
//        Plants newUser3 = new Plants(
//                "–û—Ä—Ö–∏–¥–µ—è-–º–æ—Ç—ã–ª–µ–∫ (–§–∞–ª–µ–Ω–æ–ø—Å–∏—Å) üå∏",
//                "–û—Ä—Ö–∏–¥–µ—è-–º–æ—Ç—ã–ª–µ–∫ - —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ –∏ –∏–∑—ã—Å–∫–∞–Ω–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏, –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –¥–ª—è –¥–æ–º–∞. üè°",
//                "https://rastenievod.com/wp-content/uploads/2016/06/1-92-700x625.jpg",
//                "https://rastenievod.com/wp-content/uploads/2016/06/4-87-700x605.jpg",
//                "https://rastenievod.com/wp-content/uploads/2016/06/9-44-700x499.jpg",
//                "https://rastenievod.com/wp-content/uploads/2016/06/2-93-700x619.jpg",
//                "–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è —Ä–æ—Å—Ç–∞ - –æ—Ç 20 –¥–æ 25 –≥—Ä–∞–¥—É—Å–æ–≤. üå°Ô∏è",
//                "–†–∞—Å—Ç–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –≤–ª–∞–∂–Ω–æ—Å—Ç—å –≤–æ–∑–¥—É—Ö–∞, –æ–∫–æ–ª–æ 60-80%. üíß",
//                "–û—Ä—Ö–∏–¥–µ—è –ª—é–±–∏—Ç —è—Ä–∫–∏–π —Ä–∞—Å—Å–µ—è–Ω–Ω—ã–π —Å–≤–µ—Ç, –Ω–æ —Å–ª–µ–¥—É–µ—Ç –∏–∑–±–µ–≥–∞—Ç—å –ø—Ä—è–º—ã—Ö —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –ª—É—á–µ–π. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–ø—Ä—ã—Å–∫–∏–≤–∞–π—Ç–µ –ª–∏—Å—Ç—å—è –∏ –∫–æ—Ä–Ω–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Ö–æ—Ä–æ—à—É—é –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—é. ‚òÄÔ∏è",
//                "https://youtu.be/N_WiaZ4rg2Q",
//                5 // –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–ª–∏–≤–∞ (—Ä–∞–∑ –≤ 5 –¥–Ω–µ–π)
//        );
//        firestore.collection("plants")
//                .document()
//                .set(newUser3);
//        Plants newUser4 = new Plants(
//                "–§–∏–∞–ª–∫–∞ (Saintpaulia) üå∫",
//                "–§–∏–∞–ª–∫–∞ - –∫—Ä–∞—Å–∏–≤–æ–µ –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –∫–æ–º–Ω–∞—Ç–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å —è—Ä–∫–∏–º–∏ —Ü–≤–µ—Ç–∞–º–∏, –∑–∞  –∫–æ—Ç–æ—Ä—ã–º –ª–µ–≥–∫–æ —É—Ö–∞–∂–∏–≤–∞—Ç—å. üè°",
//                "https://rastenievod.com/wp-content/uploads/2017/05/1-24-700x658.jpg",
//                "https://rastenievod.com/wp-content/uploads/2017/05/3-26-700x582.jpg",
//                "https://rastenievod.com/wp-content/uploads/2017/05/5-25-700x643.jpg",
//                "https://rastenievod.com/wp-content/uploads/2017/05/4-24-700x590.jpg",
//                "–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è —Ä–æ—Å—Ç–∞ - –æ—Ç 18 –¥–æ 24 –≥—Ä–∞–¥—É—Å–æ–≤. üå°Ô∏è",
//                "–†–∞—Å—Ç–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç —É–º–µ—Ä–µ–Ω–Ω—É—é –≤–ª–∞–∂–Ω–æ—Å—Ç—å –≤–æ–∑–¥—É—Ö–∞, –æ–∫–æ–ª–æ 40-60%. üíß",
//                "–§–∏–∞–ª–∫–∞ –ª—é–±–∏—Ç —è—Ä–∫–∏–π, –Ω–æ —Ä–∞—Å—Å–µ—è–Ω–Ω—ã–π —Å–≤–µ—Ç. –ò–∑–±–µ–≥–∞–π—Ç–µ –ø—Ä—è–º—ã—Ö —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –ª—É—á–µ–π. –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–æ–ª–∏–≤–∞–π—Ç–µ, –Ω–æ –Ω–µ –¥–æ–ø—É—Å–∫–∞–π—Ç–µ –∑–∞—Å—Ç–æ—è –≤–æ–¥—ã. ‚òÄÔ∏è",
//                "https://youtu.be/8qUExRvuXW8",
//                7 // –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–ª–∏–≤–∞ (—Ä–∞–∑ –≤ 7 –¥–Ω–µ–π)
//        );
//        firestore.collection("plants")
//                .document()
//                .set(newUser4);
//        Plants newUser2 = new Plants("–§–∏–∫—É—Å –±–µ–Ω–¥–∂–∞–º–∏–Ω–∞", "–§–∏–∫—É—Å –±–µ–Ω–¥–∂–∞–º–∏–Ω–∞ - –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å –±–ª–µ—Å—Ç—è—â–∏–º–∏ –ª–∏—Å—Ç—å—è–º–∏.",
//                "https://fitosystems.ru/images/stories/virtuemart/product/resized/DSC03256_210x210.jpg");
//        firestore.collection("plants")
//                .document()
//                .set(newUser2);
//        Plants newUser3 = new Plants("–†–∏–≤–∏–Ω–∞", "–†–∏–≤–∏–Ω–∞ ‚Äì —ç—Ç–æ –Ω–∏–∑–∫–æ—Ä–æ—Å–ª—ã–π –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∫—É—Å—Ç–∞—Ä–Ω–∏–∫ —Å–µ–º–µ–π—Å—Ç–≤–∞ –õ–∞–∫–æ–Ω–æ—Å–æ–≤—ã—Ö (Phykolaccaceae). –ï–≥–æ —Ä–æ–¥–∏–Ω–æ–π —Å—á–∏—Ç–∞—é—Ç—Å—è —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –∏ —Å—É–±—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –∑–æ–Ω—ã –ê–º–µ—Ä–∏–∫–∏."
//                ,
//                "https://rastenievod.com/wp-content/uploads/2017/03/2-6-700x605.jpg");
//        firestore.collection("plants")
//                .document()
//                .set(newUser3);
//        Plants newUser4 = new Plants("–ú–∏–∫—Ä–æ—Å–æ—Ä—É–º", "–ú–∏–∫—Ä–æ—Å–æ—Ä—É–º - —Ä–æ–¥ –ø–∞–ø–æ—Ä–æ—Ç–Ω–∏–∫–æ–≤ —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏."
//                ,
//                "https://rastenievod.com/wp-content/uploads/2017/03/6-31-700x686.jpg");
//        firestore.collection("plants")
//                .document()
//                .set(newUser4);
//        Plants newUser5 = new Plants("–î—Ä–∏–º–∏–æ–ø—Å–∏—Å", "–î—Ä–∏–º–∏–æ–ø—Å–∏—Å - –ª–∏—Å—Ç–æ–ø–∞–¥–Ω–æ–µ –≤–µ—á–Ω–æ–∑–µ–ª–µ–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ –∏–∑ —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏—Ö –æ–±–ª–∞—Å—Ç–µ–π –Æ–∂–Ω–æ–π –ê—Ñ—Ä–∏–∫–∏, –æ—Ç–Ω–æ—Å—è—â–µ–µ—Å—è –∫ —Å–µ–º–µ–π—Å—Ç–≤—É –≥–∏–∞—Ü–∏–Ω—Ç–æ–≤—ã—Ö.",
//                "https://rastenievod.com/wp-content/uploads/2017/03/3-33-700x634.jpg");
//        firestore.collection("plants")
//                .document()
//                .set(newUser5);
//        Plants newUser6 = new Plants("–§–∏–∫—É—Å –ü–∞–Ω–¥–∞", "–§–∏–∫—É—Å –ü–∞–Ω–¥–∞ - –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Å–æ—Ä—Ç —Å –Ω–µ–æ–±—ã—á–Ω—ã–º–∏ –ø–ª–æ–¥–∞–º–∏ –∏ –≥—É—Å—Ç–æ–π –∫—Ä–æ–Ω–æ–π.",
//                "https://rastenievod.com/wp-content/uploads/2017/03/4-9-700x700.jpg");
//        firestore.collection("plants")
//                .document()
//                .set(newUser6);
//        Plants newUser7 = new Plants("–ë—Ä–∏–≥–∞–º–∏—è", "–ë—Ä–∏–≥–∞–º–∏—è - —Å—É–∫–∫—É–ª–µ–Ω—Ç —Å –Ω–µ–æ–±—ã—á–Ω—ã–º –±—É—Ç—ã–ª–∫–æ–≤–∏–¥–Ω—ã–º —Å—Ç–µ–±–ª–µ–º –∏ –±–ª–µ–¥–Ω–æ-–∑–µ–ª–µ–Ω—ã–º–∏ –ª–∏—Å—Ç–æ—á–∫–∞–º–∏.",
//                "https://rastenievod.com/wp-content/uploads/2017/03/2-7-700x744.jpg ");
//        firestore.collection("plants")
//                .document()
//                .set(newUser7);
        adapter = new PlantsAdapter();
        binding.recycler.setLayoutManager(new LinearLayoutManager(requireContext()));
        binding.recycler.setAdapter(adapter);
        binding.profileButton.setOnClickListener(v -> {
            Intent intent = new Intent(requireContext(), User_profil.class);
            startActivity(intent);
        });

        binding.notificationButton.setOnClickListener(v -> {
            if (FirebaseAuth.getInstance().getCurrentUser() != null) {
                Intent intent = new Intent(requireContext(), NotificationsActivity.class);
                startActivity(intent);
            }else {
                Toast.makeText(requireContext(), "–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–æ–∏ÃÜ–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç", Toast.LENGTH_SHORT).show();
            }

        });
        binding.searchButton.setOnClickListener(v -> {
            Intent intent = new Intent(requireContext(), Search_activiti.class);
            startActivity(intent);
        });
        checkNotifications();


        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º ProgressBar –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        binding.progressBar.setVisibility(View.VISIBLE);

//        FirebaseFirestore firestore = FirebaseFirestore.getInstance();
        firestore.collection("plants")
                .get()
                .addOnSuccessListener(queryDocumentSnapshots -> {
                    List<Plants> plants = new ArrayList<>();
                    for (QueryDocumentSnapshot document : queryDocumentSnapshots) {
                        Plants plant = document.toObject(Plants.class);
                        plants.add(plant);
                    }
                    adapter.setItems(plants);
                    // –°–∫—Ä—ã–≤–∞–µ–º ProgressBar –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                    binding.progressBar.setVisibility(View.GONE);
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º RecyclerView —Å –¥–∞–Ω–Ω—ã–º–∏
                    binding.recycler.setVisibility(View.VISIBLE);
                })
                .addOnFailureListener(e -> {
                    Log.e("Firestore", "Error getting documents.", e);
                    // –î–æ–±–∞–≤—å—Ç–µ –∑–¥–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    // –°–∫—Ä—ã–≤–∞–µ–º ProgressBar –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                    binding.progressBar.setVisibility(View.GONE);
                });
    }
    private void checkNotifications() {
        if (FirebaseAuth.getInstance().getCurrentUser() != null) {


        FirebaseFirestore firestore = FirebaseFirestore.getInstance();

        firestore.collection("users").document(FirebaseAuth.getInstance().getCurrentUser().getUid()) // –ó–∞–º–µ–Ω–∏—Ç–µ "userId" –Ω–∞ —Ç–µ–∫—É—â–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                .get()
                .addOnSuccessListener(documentSnapshot -> {
                    if (documentSnapshot.contains("notifications")) {
                        ArrayList<Map<String, Object>> notificationsList = (ArrayList<Map<String, Object>>) documentSnapshot.get("notifications");
                        if (notificationsList != null && !notificationsList.isEmpty()) {
                            binding.notificationButton.setImageResource(R.drawable.free_icon_notifications_5189239); // –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ—Å—É—Ä—Å –∞–∫—Ç–∏–≤–Ω–æ–π –∏–∫–æ–Ω–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                        } else {
                            Log.wtf("Firestore", "Notifications list is null or empty");
                        }
                    } else {
                        Log.e("Firestore", "Document does not contain 'notifications' field");
                    }
                })
                .addOnFailureListener(e -> Log.e("Firestore", "Error checking notifications.", e));
    }}
}



